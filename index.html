<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bitcoin ETF Cost Basis (Lite)</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
background: linear-gradient(135deg, #f0f9ff 0%, #e6f7ff 100%);
padding: 20px;
min-height: 100vh;
color: #2d3748;
}
.container { max-width: 1200px; margin: 0 auto; }
.card {
background: white;
border-radius: 16px;
padding: 25px;
margin-bottom: 20px;
box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}
h1 { color: #2d3748; margin-bottom: 10px; font-size: 28px; }
.subtitle { color: #718096; font-size: 14px; margin-bottom: 20px; }
.metrics {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 20px;
margin-bottom: 20px;
}
.metric-card {
background: white;
border-radius: 16px;
padding: 25px;
box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}
.metric-label {
color: #718096;
font-size: 14px;
text-transform: uppercase;
letter-spacing: 0.5px;
margin-bottom: 10px;
}
.metric-value {
font-size: 32px;
font-weight: bold;
color: #2d3748;
margin-bottom: 5px;
}
.metric-change { font-size: 14px; font-weight: 600; }
.positive { color: #48bb78; }
.negative { color: #f56565; }
textarea {
width: 100%;
min-height: 300px;
padding: 15px;
border: 2px solid #e2e8f0;
border-radius: 8px;
font-family: 'Courier New', monospace;
font-size: 13px;
resize: vertical;
margin-bottom: 15px;
}
button {
background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
color: white;
border: none;
padding: 15px 40px;
border-radius: 8px;
font-size: 18px;
font-weight: 600;
cursor: pointer;
transition: transform 0.2s;
}
button:hover { transform: translateY(-2px); }
.status {
margin-top: 15px;
padding: 15px;
border-radius: 8px;
font-size: 14px;
font-weight: 600;
}
.status.success { background: #c6f6d5; color: #22543d; }
.status.error { background: #fed7d7; color: #742a2a; }
.info-box {
background: #ebf8ff;
border-left: 4px solid #3182ce;
padding: 20px;
margin-bottom: 15px;
border-radius: 4px;
font-size: 14px;
color: #2c5282;
line-height: 1.6;
}
.timeframe-btn {
padding: 8px 16px;
background: #e2e8f0;
border: 2px solid #cbd5e0;
border-radius: 6px;
cursor: pointer;
font-weight: 600;
font-size: 13px;
color: #2d3748;
transition: all 0.2s;
margin-right: 10px;
margin-bottom: 10px;
}
.timeframe-btn:hover { background: #cbd5e0; }
.timeframe-btn.active {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
border-color: #667eea;
}
</style>
</head>
<body>
<div class="container">
<div class="card">
<h1>üìä Bitcoin ETF Cost Basis (Lite)</h1>
<p class="subtitle">Free tool by <a href="https://x.com/btcbasistracker" target="_blank" style="color:#3182ce; text-decoration:underline;">@btcbasistracker</a></p>
</div>
<div class="info-box">
This lite version shows real-time ETF cost basis vs. BTC price
</div>
<!-- === METRICS: Added Distance from Basis === -->
<div class="metrics">
<div class="metric-card">
<div class="metric-label">Current BTC Price</div>
<div class="metric-value" id="currentPrice">--</div>
<div class="metric-change" id="priceChange">Latest Date</div>
</div>
<div class="metric-card">
<div class="metric-label">ETF Cost Basis</div>
<div class="metric-value" id="costBasis">--</div>
<div class="metric-change" id="basisChange">--</div>
</div>
<div class="metric-card">
<div class="metric-label">Distance from Basis</div>
<div class="metric-value" id="distancePercent">--</div>
<div class="metric-change" id="distanceStatus">--</div>
</div>
<div class="metric-card">
<div class="metric-label">Total BTC Holdings</div>
<div class="metric-value" id="totalBTC">--</div>
<div class="metric-change" id="btcChange">--</div>
</div>
<div class="metric-card">
<div class="metric-label">Total USD Invested</div>
<div class="metric-value" id="totalUSD">--</div>
<div class="metric-change" id="usdChange">--</div>
</div>
</div>
<div class="card">
<h2 style="margin-bottom: 15px; color: #2d3748;">Price vs Cost Basis</h2>
<div style="margin-bottom: 15px;">
<button class="timeframe-btn active" onclick="setTimeframe('all')">ALL</button>
<button class="timeframe-btn" onclick="setTimeframe('1y')">1Y</button>
<button class="timeframe-btn" onclick="setTimeframe('6m')">6M</button>
<button class="timeframe-btn" onclick="setTimeframe('3m')">3M</button>
<button class="timeframe-btn" onclick="setTimeframe('1m')">1M</button>
<button class="timeframe-btn" onclick="setTimeframe('1w')">1W</button>
</div>
<canvas id="mainChart"></canvas>
</div>
<div class="card">
<h2 style="margin-bottom: 15px; color: #2d3748;">üìã Paste Your Data</h2>
<div class="info-box">
<strong>Instructions:</strong>
Paste ETF flow data and BTC price data separately below. Accepts: YYYY-MM-DD, DD/MM/YYYY, MM/DD/YYYY
</div>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px;">
<div>
<label style="display: block; font-weight: 600; margin-bottom: 8px; color: #2d3748;">
ETF Flow Data
</label>
<textarea id="flowInput" placeholder="Date, Flow (millions)"></textarea>
</div>
<div>
<label style="display: block; font-weight: 600; margin-bottom: 8px; color: #2d3748;">
BTC Price Data
</label>
<textarea id="priceInput" placeholder="Date, Price"></textarea>
</div>
</div>
<button onclick="calculate()">üßÆ CALCULATE COST BASIS</button>
<div id="status"></div>
</div>
<!-- === IMPROVEMENT 2: ENHANCED FOOTER CTA === -->
<div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-align: center;">
<h3 style="color: white; margin-bottom: 10px;">Want Advanced Analytics?</h3>
<p style="opacity: 0.9; margin-bottom: 15px;">
Get institutional-grade insights:
</p>
<ul style="list-style: none; padding: 0; margin: 15px 0; opacity: 0.9;">
<li>üìä Historical pattern matching (Similar Conditions)</li>
<li>üéØ Multi-factor confluence alerts</li>
<li>‚ö° Basis velocity & flow efficiency</li>
<li>‚è±Ô∏è Mean reversion timing</li>
<li>üß™ Backtested strategies</li>
</ul>
<a href="https://x.com/btcbasistracker" target="_blank"
style="display: inline-block; background: white; color: #667eea; padding: 12px 30px; border-radius: 8px; text-decoration: none; font-weight: bold; margin-top: 10px;">
Follow @btcbasistracker ‚Üí
</a>
</div>
</div>
<script>
let chart, results = [], currentTimeframe = 'all', statistics = {};
let moveThreshold = 2.0;

// === EXACTLY FROM _07.txt ===
function parseDate(dateStr) {
dateStr = dateStr.trim();
if (/^\d{4}-\d{2}-\d{2}$/.test(dateStr)) return dateStr;
if (/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(dateStr)) {
const parts = dateStr.split('/');
let day = parts[0], month = parts[1];
if (parseInt(day) > 12 && parseInt(month) <= 12) {
} else if (parseInt(month) > 12 && parseInt(day) <= 12) {
[day, month] = [month, day];
}
day = day.padStart(2, '0');
month = month.padStart(2, '0');
const year = parts[2];
return `${year}-${month}-${day}`;
}
const monthNames = {
'jan': '01', 'feb': '02', 'mar': '03', 'apr': '04',
'may': '05', 'jun': '06', 'jul': '07', 'aug': '08',
'sep': '09', 'oct': '10', 'nov': '11', 'dec': '12'
};
const monthMatch = dateStr.match(/(\d{1,2})[\/-]([a-z]{3})[\/-](\d{2,4})/i);
if (monthMatch) {
const day = monthMatch[1].padStart(2, '0');
const month = monthNames[monthMatch[2].toLowerCase()];
let year = monthMatch[3];
if (year.length === 2) year = '20' + year;
return `${year}-${month}-${day}`;
}
if (dateStr.includes('T')) return dateStr.split('T')[0];
try {
const d = new Date(dateStr);
if (!isNaN(d.getTime())) return d.toISOString().split('T')[0];
} catch (e) {}
return null;
}

function parseData(text) {
const lines = text.trim().split('\n');
const data = {};
for (let line of lines) {
line = line.trim();
if (!line || line.toLowerCase().includes('date')) continue;
let parts;
if (line.includes('\t')) parts = line.split('\t').map(p => p.trim());
else if (line.includes(',')) parts = line.split(',').map(p => p.trim());
else parts = line.split(/\s+/).map(p => p.trim());
if (parts.length >= 2) {
const dateStr = parts[0];
const value = parseFloat(parts[1].replace(/,/g, ''));
const date = parseDate(dateStr);
if (date && !isNaN(value)) {
data[date] = value;
}
}
}
return data;
}

function calcCostBasis(data) {
let btc = 0, usd = 0, res = [];
data.forEach(item => {
const flowUSD = item.flow * 1e6;
if (item.flow > 0) {
btc += flowUSD / item.price;
usd += flowUSD;
} else if (item.flow < 0) {
const sold = Math.abs(flowUSD) / item.price;
if (btc > 0) {
const prop = Math.min(sold / btc, 1);
btc -= sold;
usd -= prop * usd;
btc = Math.max(0, btc);
usd = Math.max(0, usd);
}
}
res.push({
...item,
btcChange: item.flow > 0 ? flowUSD/item.price : -Math.abs(flowUSD)/item.price,
totalBTC: btc,
totalUSD: usd,
costBasis: btc > 0 ? usd/btc : 0
});
});
return res;
}

// === CHART ZOOM LOGIC (FROM _07.txt) ===
function setTimeframe(tf) {
currentTimeframe = tf;
document.querySelectorAll('.timeframe-btn').forEach(b => b.classList.remove('active'));
event.target.classList.add('active');
updateChart();
}

function getFiltered() {
if (!results.length || currentTimeframe === 'all') return results;
const now = new Date(results[results.length-1].date);
let cut = new Date(now);
if (currentTimeframe === '1y') cut.setFullYear(cut.getFullYear()-1);
else if (currentTimeframe === '6m') cut.setMonth(cut.getMonth()-6);
else if (currentTimeframe === '3m') cut.setMonth(cut.getMonth()-3);
else if (currentTimeframe === '1m') cut.setMonth(cut.getMonth()-1);
else if (currentTimeframe === '1w') cut.setDate(cut.getDate()-7);
return results.filter(r => new Date(r.date) >= cut);
}

// === METRICS UPDATE (WITH NEW DISTANCE + TIMESTAMP) ===
function updateMetrics() {
if (!results.length) return;
const l = results[results.length-1];
document.getElementById('currentPrice').textContent = '$'+l.price.toLocaleString();
// === IMPROVEMENT 3: LAST UPDATED TIMESTAMP ===
const lastUpdate = new Date().toLocaleString();
document.getElementById('priceChange').textContent = l.date + ' (calc: ' + lastUpdate + ')';
document.getElementById('costBasis').textContent = '$'+l.costBasis.toLocaleString();
const diff = l.price - l.costBasis;
const pct = (diff/l.costBasis)*100;
const bEl = document.getElementById('basisChange');
bEl.textContent = (diff>0?'‚Üë':'‚Üì')+' $'+Math.abs(diff).toLocaleString()+' ('+(pct>0?'+':'')+pct.toFixed(2)+'%)';
bEl.className = 'metric-change '+(diff>=0?'positive':'negative');

// === IMPROVEMENT 1: DISTANCE FROM BASIS ===
document.getElementById('distancePercent').textContent = (pct>0?'+':'')+pct.toFixed(2)+'%';
const dEl = document.getElementById('distanceStatus');
dEl.textContent = pct>0?'Above cost basis':'Below cost basis';
dEl.className = 'metric-change '+(pct>0?'positive':'negative');

document.getElementById('totalBTC').textContent = l.totalBTC.toLocaleString();
document.getElementById('totalUSD').textContent = '$'+(l.totalUSD/1e6).toFixed(1)+'M';
if (results.length > 1) {
const p = results[results.length-2];
const bDiff = l.totalBTC - p.totalBTC;
const bEl2 = document.getElementById('btcChange');
bEl2.textContent = (bDiff>0?'+':'')+bDiff.toLocaleString()+' BTC';
bEl2.className = 'metric-change '+(bDiff>=0?'positive':'negative');
const uDiff = (l.totalUSD-p.totalUSD)/1e6;
const uEl = document.getElementById('usdChange');
uEl.textContent = (uDiff>0?'+':'')+'$'+uDiff.toFixed(1)+'M';
uEl.className = 'metric-change '+(uDiff>=0?'positive':'negative');
}
}

function updateChart() {
const ctx = document.getElementById('mainChart').getContext('2d');
if (chart) chart.destroy();
const data = getFiltered();
if (!data.length) return;
chart = new Chart(ctx, {
type: 'line',
data: {
labels: data.map(d=>d.date),
datasets: [
{
label: 'BTC Price',
data: data.map(d=>d.price),
borderColor: '#667eea',
backgroundColor: 'rgba(102,126,234,0.1)',
borderWidth: 3,
fill: true,
tension: 0.4
},
{
label: 'Cost Basis',
data: data.map(d=>d.costBasis),
borderColor: '#f56565',
borderWidth: 3,
borderDash: [5,5],
fill: false,
tension: 0.4
}
]
},
options: {
responsive: true,
aspectRatio: 2.5,
interaction: { intersect: false, mode: 'index' },
plugins: {
legend: { position: 'top', labels: { font: { size: 12 } } },
tooltip: {
callbacks: {
label: c => c.dataset.label + ': $' + c.parsed.y.toLocaleString()
}
}
},
scales: {
y: {
ticks: { callback: v => '$'+v.toLocaleString() },
grid: { color: 'rgba(0,0,0,0.05)' }
},
x: {
ticks: { maxRotation: 45, minRotation: 45, maxTicksLimit: 20 },
grid: { display: false }
}
}
}
});
}

// === CALCULATE (EXACT FROM _07.txt) ===
function calculate() {
const status = document.getElementById('status');
status.textContent = 'Calculating...';
status.className = 'status';
try {
const flowData = parseData(document.getElementById('flowInput').value);
const priceData = parseData(document.getElementById('priceInput').value);
if (!Object.keys(flowData).length) throw new Error('No valid flow data');
if (!Object.keys(priceData).length) throw new Error('No valid price data');
const merged = [];
for (let date in flowData) {
if (priceData[date]) merged.push({date, flow: flowData[date], price: priceData[date]});
}
if (!merged.length) throw new Error('No matching dates');
merged.sort((a,b) => new Date(a.date) - new Date(b.date));
results = calcCostBasis(merged);
updateMetrics();
updateChart();
const l = results[results.length-1];
status.textContent = '‚úì SUCCESS! Matched '+results.length+' dates. Cost Basis: $'+l.costBasis.toLocaleString();
status.className = 'status success';
} catch (err) {
console.error(err);
status.textContent = '‚úó Error: ' + err.message;
status.className = 'status error';
}
}
</script>
</body>
</html>
